\chapter{Description of the input files\label{chap:general}}
%-----------------------------------------------------------

\lettrine[lines=2, loversize=0.0, lraise=0.5]{T}{he} input files required by \diva for simple 2-D analysis are described here. 
Basically, only three files are needed as input:

\begin{enumerate}
\item a file containing the data (\texttt{data.dat})
\item the specification of the domain of analysis (\texttt{coast.cont}) and 
\item the list of the parameters used during the analysis (\texttt{param.par}).
\end{enumerate}


\minitoc

\newpage % 


\begin{center}
\fbox{
\begin{minipage}{0.7\textwidth}
\vspace{.25cm}
\textbf{Convention:} \diva works with decimal numbers\\ 
represented with\quad \textbf{.}\quad  not \quad \textbf{,}
\vspace{.25cm}
\end{minipage}
}
\end{center}


\btips
Use unix \command{sed} to replace \textbf{,} by \textbf{.}:
\begin{lstlisting}[style=Bash]
[charles@gher13 Software]$ cat file1.dat | sed s/,/./g > file2.dat
\end{lstlisting}

where: \file{file1.dat} is the old file and \\
\hphantom{where:} \file{file2.dat} is the file where the replacement has been made.
\etips


\btips
Use editor \textsl{vi} to replace \textbf{,} by \textbf{.}:

Simply type:
\begin{verbatim}
vi file1.dat
:,$s/,/./g
\end{verbatim}
\etips

%---------------
\section{Data}
%----------------

The data file (\file{data.dat}) contains three (or four) columns: 
\begin{enumerate}
\item the $x-$coordinate (usually the longitude, but can also be an horizontal distance in $km$, or any coordinate).
\item the $y-$coordinate (usually the latitude).
\item the data value.
\item the weight [optional] 
\end{enumerate}
If the number of column is three, the fourth column is assumed to take the value $1$. If there are more than four columns, columns 5 and higher are not used by the software.% (but can be used by the user) .

\begin{exfile}[htpb]
\begin{footnotesize}
\texttt{
25 25  5 1\\
25 75 10 1\\
75 75  5 1\\
75 25 10 1} 
\end{footnotesize}
\caption{data.dat\label{ex:data.dat}}
\end{exfile}


\begin{figure}[H]
\centering
\includegraphics[width=.45\textwidth]{island_data}
\caption{Example of a data file and its graphical representation.}
\end{figure}


\section{Contour\label{contourdiva}}
%--------------------------------------

The contour file (\file{coast.cont}) delimits the region where the analysis has to be performed, i.e., it specifies the boundary between land and sea. The file is defined this way:
\begin{enumerate}
\item The first line indicates the number of contours ($M$) in the region of interest.
\item The second line tells the number of points ($N_{1}$) in the first contour.
\item The next $N_1$ lines are the coordinates of the points of the first contour. The convention for the contour is that \textit{the land is on the right when you follow the points successively}. The contour is automatically closed, meaning that the last point of a given contour is be from the first one. 
\item The following line is the number of points ($N_{2}$) of the second contour.
\item \ldots
\item The last $N_M$ lines are the coordinates of the points of the last contour.
\end{enumerate}

\begin{exfile}[htpb]
\begin{footnotesize}
\texttt{2\\
4\\
0 0\\
100 0\\
100 100\\
0 100\\
4\\
40 40\\
40 60\\
60 60\\
60 40\\} 
\end{footnotesize}
\caption{coast.dat\label{ex:coast.dat}}
\end{exfile}

Here, our contour is made up of 2 sub-contours: 
\begin{itemize}
\item the first one with 4 points (and four edges): $(0,0)$, $(100,0)$, $(100,100)$ and $(0,100)$. It is the main contour.
\item the second one with also 4 points. It is the interior contour (island).
\end{itemize}

\begin{figure}[H]
\centering 
\includegraphics[width=.45\textwidth]{island_contour}
\caption{Example of a contour file and its graphical representation.}
\end{figure}



\section[Additional points of analysis]{Locations of additional points where analysis is required (optional)}
%--------------------------------------------------------------------------------

The file \file{valatxy.coord} is a two-column list of locations where you want the analysis to be performed.  

\begin{exfile}[htpb]
\begin{footnotesize}
\texttt{-5 0\\
-4.7436 0\\
-4.4872 0\\
-4.2308 0\\
-3.9744 0\\
-3.7179 0\\
-3.4615 0} 
\end{footnotesize}
\caption{valatxy.coord\label{ex:valatxy}}
\end{exfile}

If there are more than two columns, columns 3 and higher are not used.

\section{Parameters\label{sec:param.par}}
%-------------------------------------------

The file \file{./input/param.par} determines the main analysis parameters and options of \diva. A clear understanding of is essential for a propoer use of the software. 

\begin{exfile}[htpb]
\begin{footnotesize}
\begin{verbatim}
# Lc: correlation length (in units coherent with your data)
10
# icoordchange (=0 if no change of coordinates is to be performed (...)
1
# ispec (output files required)
3
# ireg (mode selected for background field: 0=null guess;         (...)
1
# xori: x-coordinate of the first grid point of the output
15
# yori: y-coordinate of the first grid point of the output
66
# dx: step of output grid
0.2
# dy: step of output grid
0.05
# nx: number of grid points in the x-direction
300
# ny: number of grid points in the y-direction
300
# valex (exclusion value)
-999.0
# snr signal to noise ratio of the whole dataset
30
# varbak: variance of the background field. If zero,              (...)
0
\end{verbatim}
\end{footnotesize}
\caption{param.par\label{paramfile}}
\end{exfile}



\subsection{\texttt{Lc}}
% ------------------------

Global correlation length used for the analysis (see Sec. \ref{sec:parammeaning} for the physical meaning).

\subsection{\texttt{icoordchange}\label{sec:icoord}}
%---------------------------------------------------


Specifies the desired type of coordinate system:\\

\texttt{icoordchange} \begin{minipage}[t]{.7\textwidth} = $0$ if no change is necessary (data position in kilometres);\\
                                                        = $1$ if data positions are given in degrees;\\
                                                        = $2$ if data positions are given in degrees and your domain extends on a wide span of latitude                                                           (uses a cosine projection);\\
                                                        = $-xscale$ to scale $x$ coordinates by $xscale$ before doing anything ( for vertical                                                              sections)
                      \end{minipage}
                      
                      
\subsection{\texttt{ispec}}
%--------------------------

Four base-values specifies the required error outputs:\\

\texttt{ispec}       = 0\qquad: no error field requested\\
\hphantom{\texttt{ispec}}  = 1\qquad: gridded error field specified by \texttt{xori}, \texttt{yori}, \texttt{nx} and \texttt{ny}; \\
\hphantom{\texttt{ispec}}  = 2\qquad: errors at data locations;\\
\hphantom{\texttt{ispec}}  = 4\qquad: errors at locations listed in \file{valatxy.coord}.

Then you can combine these four values to obtain several error outputs:

\examples\\
\texttt{ispec}             = 3 (=1+2)\hphantom{+4} \qquad \begin{minipage}[t]{.7\textwidth}means you want gridded error field as well as errors at data locations;\end{minipage}\\ 
\texttt{ispec}             = 7 (=1+2+4) \qquad means you want the three error files.


For computing errors with the real covariance function, %(Sec. \ref{})
simply multiply the \texttt{ispec} value by $-1$:

\example\\
\texttt{ispec}             = -7 \qquad \begin{minipage}[t]{.7\textwidth}{means you want the three error files computed with the help of the real covariance function.}\end{minipage}


Finally, a \textit{poor man's} error estimate (quick and underestimated error field) is available by adding $+10$ to the \texttt{ispec} value:

\example\\
\texttt{ispec}             = 16 \qquad \begin{minipage}[t]{.7\textwidth}{means you want errors at data locations and at points listed in \file{valatxy.coord} computed with the \textit{poor man's} error estimate.}\end{minipage}


\subsection{\texttt{ireg}}

Specification of the background field which is subtracted from the data field (Sec. \ref{sec:backgroundfield}).

\texttt{ireg}             = 0\qquad: no background field is subtracted (assuming data are already anomalies); \\
\hphantom{\texttt{ireg}}  = 1 \qquad: the data mean value is subtracted;\\
\hphantom{\texttt{ireg}}  = 2 \qquad: the linear regression of the data (plane) is subtracted.

\subsection{\texttt{xori/yori, nx/ny}}

\texttt{xori/yori} indicate the coordinates of the first grid point while \texttt{nx/ny} indicate the number of grid points in \texttt{x/y} directions.



\subsection{\texttt{valex}}
%-----------------------------

Exclusion value: value used to fill the output matrix when a point corresponds with land.


\subsection{\texttt{snr}}
%---------------------------

Signal-to-noise ratio of the whole dataset (Section~\ref{sec:formulation}).


\subsection{\texttt{varbak}}
%------------------------------

Variance of the background field.



\section{Working directories (2-D analysis)}
% ------------------------------

For 2 dimension analysis, the main working directory is \directory{divastripped}. Inside it, we have:
\begin{lstlisting}[style=Bash]
[charles@gher13 divastripped]$ tree -d -L 2
.
|-- divawork
|   `-- sub
|-- gnuwork
|   |-- gnuplottools
|   `-- plots
|-- input
|-- meshgenwork
`-- output
    |-- ghertonetcdf
    `-- meshvisu

10 directories
\end{lstlisting}


\begin{description}

\item[\directory{divawork}] is where the intermediate files are produced.
\item[\directory{gnuwork}] contains the scripts for generating the plots with gnuplot. These plots will be located in the sub-folder \directory{plots}.
\item[\directory{input}] contains the input files presented in this section.
\item[\directory{divawork}] is the working directory for the mesh generation.
\item[\texttt{output}] contains the analysis results. In \directory{ghertonetcdf}, one can find the output in NetCDF format (file \file{results.nc}), while \directory{meshvisu} stores the files that describe the mesh.
\end{description}